{% extends "layout.html" %}
{% set title = "List of Bottle Drop Points" %}
{% block content %}
    <div class="page-header">
        <h1>{{ title }}</h1>
    </div>
    <div class="row">
        <div class="col-sm-8">
            <div class="btn-group" role="group" aria-label="filters">
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                        Filter location <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                    {% for location in all_locations %}
                        <li><a href="#">{{ location }}</a></li>
                    {% endfor %}
                    </ul>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                        Filter state <span class="caret"></span>
                    </button>
                    <!-- TODO: implement state filter -->
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">
                        more <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a data-toggle="collapse" data-target=".dp-removed"
                               href="#">Show removed drop points</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-sm-4 text-right">
            <a class="btn btn-primary" href="{{ url_for("create_dp") }}">
                Create a new drop point
            </a>
        </div>
    </div>
    <p></p>
    <table class="table table-hover">
        <thead>
        <tr>
            <th>Number</th>
            <th>Location</th>
            <th>Last state</th>
            <th></th>
            <th></th>
            <th></th>
            <th class="hidden-xs">Priority</th>
            <th class="hidden-xs">Reports</th>
        </tr>
        </thead>
        <tbody>
        {% for dp in all_dps %}
            <tr{{ {"class": "dp-removed collapse"}|xmlattr if dp.removed }}>
                <td>
                    {{ "<s>"|safe if dp.removed }}{{ dp.number }}{{ "</s>"|safe if dp.removed }}</td>
                <td>
                    {{ "<s>"|safe if dp.removed }}{{ dp.location.description if dp.location.description else "unknown" }}{{ "</s>"|safe if dp.removed }}</td>
                <td>{{ "<s>"|safe if dp.removed }}
                    {% if dp.last_state == "OVERFLOW" %}
                        <span class="label label-danger">Overflowing</span>
                    {% elif dp.last_state == "FULL" %}
                        <span class="label label-warning">Full</span>
                    {% elif dp.last_state == "REASONABLY_FULL" %}
                        <span class="label label-info">Reasonably full</span>
                    {% elif dp.last_state == "SOME_BOTTLES" %}
                        <span class="label label-primary">Some bottles</span>
                    {% elif dp.last_state == "EMPTY" %}
                        <span class="label label-success">Empty</span>
                    {% else %}
                        <span class="label label-warning">Unknown</span>
                    {% endif %}
                    {{ "</s>"|safe if dp.removed }}</td>
                <td>
                    <span class="clickable glyphicon glyphicon-search"
                          title="View drop point details"
                          data-dp_modal_pane="details"
                          data-dp_number="{{ dp.number }}"></span>
                </td>
                <td>
                    <span class="clickable glyphicon glyphicon-bullhorn"
                          title="Report this drop point"
                          data-dp_modal_pane="report"
                          data-dp_number="{{ dp.number }}"></span>
                </td>
                <td>
                    <span class="clickable glyphicon glyphicon-wrench"
                          title="Log a drop point visit"
                          data-dp_modal_pane="visit"
                          data-dp_number="{{ dp.number }}"></span>
                </td>
                <td class="hidden-xs">
                    {{ "<s>"|safe if dp.removed }}{{ "%0.2f"|format(dp.priority) }}{{ "</s>"|safe if dp.removed }}</td>
                <td class="hidden-xs">
                    {{ "<s>"|safe if dp.removed }}{{ dp.reports_new }}{{ "</s>"|safe if dp.removed }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% include "dp_modals.html" %}
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/dp_modals.js') }}"></script>
<script type="text/javascript">
    var all_dps_geojson = {{ all_dps_geojson|safe }};
</script>
{% endblock %}
{# vim: set expandtab ts=4 sw=4: #}

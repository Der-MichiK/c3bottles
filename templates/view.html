{% extends "layout.html" %}
{% set title = "Drop Point Details" %}
{% import "macros/states.html" as states %}
{% import "macros/actions.html" as actions %}
{% block content %}
    {% if dp != None %}
        <div class="page-header">
            <h1>Details of Drop Point {{ dp.number }}</h1>
        </div>
        <div class="row">
            <div class="col-sm-8">
                <dl class="dl-horizontal">
                    <dt>Current location:</dt>
                    <dd>{{ dp.get_current_location().description if dp.get_current_location().description else "somewhere" }} on level {{ dp.get_current_location().level|string }}</dd>
                    <dt>Visit priority:</dt>
                    <dd>{{ "%0.2f"|format(dp.get_priority()) }}</dd>
                    <dt>Number of crates:</dt>
                    <dd>{{ dp.get_current_crate_count() }}</dd>
                </dl>
            </div>
            <div class="col-sm-4 text-right">
                <span class="h1">{{ states.label(dp.get_last_state()) }}</span>
            </div>
        </div>
        <h2>History</h2>
        <hr>
        <table class="table table-hover">
        <thead>
        <tr>
            <th>Time</th>
            <th>Event</th>
        </tr>
        </thead>
        <tbody>
        {% for event in history %}
        <tr>
            <td>{{ event.time.strftime("%Y-%m-%d %H:%M:%S") }}</td>
            <td>
                {% if event.drop_point %}
                    Drop point {{ event.drop_point.number }} created
                {% elif event.capacity %}
                    Number of crates set to {{ event.capacity.crates }}
                {% elif event.location %}
                    Location set to {{ event.location.description if event.location.description else "somewhere" }}
                    on level {{ event.location.level|string }}
                {% elif event.report %}
                    Report submitted and drop point seen as: {{ states.label(event.report.state) }}
                {% elif event.visit %}
                    Drop point visited and maintenance performed: {{ actions.label(event.visit.action) }}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
        </table>
    {% else %}
        <div class="page-header">
            <h1>{{ title }}</h1>
        </div>
        <p>Drop point not found.</p>
    {% endif %}
{% endblock %}
{# vim: set expandtab ts=4 sw=4: #}
